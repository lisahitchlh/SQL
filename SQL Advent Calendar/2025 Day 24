-- As the New Year begins, the goals tracker team wants to understand how user types differ. 
-- How many completed goals does the average user have in each user_type?

WITH completedcount AS
(
  SELECT COUNT(goal_id) as count_goals
  , user_id
  FROM user_goals
  WHERE goal_status = "Completed"
  GROUP BY user_id),

  lookup AS
  (SELECT user_id, user_type
  FROM user_goals
  GROUP BY 1,2),

  joined AS
  (SELECT *
  FROM completedcount as c
  JOIN lookup as l
  ON c.user_id=l.user_id)
  
SELECT AVG(count_goals)
  , user_type
  FROM joined
GROUP BY user_type
